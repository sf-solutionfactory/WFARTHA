@*//MGC 04 - 10 - 2018 Botones para acciones*@
@model WFARTHA.Models.DocumentoFlujo
@*@model WFARTHA.Models.DOCUMENTO_MOD //MGC 04-10-2018 Botones para acciones*@

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.pagina_r = 201;
    ViewBag.carpeta_r = 200;
    WFARTHA.Services.FormatosC formatoc = new WFARTHA.Services.FormatosC();
    List<WFARTHA.Models.DOCUMENTOR_MOD> drets = ViewBag.ret as List<WFARTHA.Models.DOCUMENTOR_MOD>;
    WFARTHA.Entities.PROVEEDOR dprov = ViewBag.prov as WFARTHA.Entities.PROVEEDOR;
    List<WFARTHA.Models.DOCUMENTORP_MOD> lstDrp = ViewBag.DocsRp as List<WFARTHA.Models.DOCUMENTORP_MOD>;
    List<string> colsret = ViewBag.Retenciones as List<string>;
    var total = ViewBag.total;
    var montomd = formatoc.toShow(total, ViewBag.dec);

}

<link type="text/css" href="~/Content/datatables.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery.dataTables.min.js"></script>

<script src="~/Scripts/details.js"></script>
<script src="~/Scripts/formatos.js"></script>
@if (ViewBag.error != "")
{
    <script>
    $(document).ready(function () {

        function errorMessage(msg) {
            M.toast({ html: msg });
        }
        var message = '@ViewBag.error';

        if (message != "") {
            errorMessage(message);
        }
    });
    </script>
}


@if (TempData["error"] != null)
{
    @*<div class="row red-text">
            @ViewBag.Error
        </div>*@

    if (TempData["error"].ToString() != "")
    {
        <script>
                /**/
                /**/
                M.toast({ html: '@TempData["error"]', classes: '' });
                /**/
                /**/
        </script>
    }
}

<input id="miles" name="miles" type="hidden" value="@ViewBag.miles">
<input id="dec" name="dec" type="hidden" value="@ViewBag.dec">
<input id="auxS" name="auxS" type="hidden" value="">


<div class="row" style="margin-bottom:0">

    @{WFARTHA.Entities.USUARIO us = ViewBag.usuario;

        <div class="col s12 m3 l2">
            <div class="row" style="margin-bottom:0">
                <div class="input-field col s12">
                    @Html.EditorFor(model => model.D.USUARIOC_ID, "Usuario", new { htmlAttributes = new { @disabled = "disabled", @Value = us.ID, @id = "txt_user" } })
                    @Html.LabelFor(model => model.D.USUARIOC_ID, "Usuario NT", new { @id = "lbl_userid" })
                </div>
            </div>
        </div>
    }

    <style>
        .anexosWidth {
            width: 8px;
        }

        .div_left {
            float: left;
        }

        .div_right {
            float: right;
        }

        .div_bottom {
            clear: both;
        }

        .hr_bw {
            height: 4px;
            border: 0;
            margin-bottom: 0px;
            padding: 0;
            background-color: #ccc;
        }

        .hr_color {
            height: 6px;
            border: 0;
            margin: 0 0;
            padding: 0;
            background-color: #B90C46;
        }

        .hidden {
            display: none;
        }

        .tabs_menu {
            width: auto;
        }

        td.select_row {
            background: url('../images/playb.png') no-repeat center center;
            cursor: pointer;
        }

        tr.selected td.select_row {
            background: url('../images/play.png') no-repeat center center;
        }

        td.detail_row {
            background: url('../images/expandm.png') no-repeat center center;
            cursor: pointer;
        }

        tr.details td.detail_row {
            background: url('../images/expandl.png') no-repeat center center;
        }

        .errorMaterial {
            background-color: red;
        }

        .errorProveedor {
            background-color: red;
        }

        .estiloT {
            margin: 0 auto;
            width: 100%;
            clear: both;
            border-collapse: collapse;
            table-layout: fixed;
        }
    </style>
    @*MGC 04-10-2018 Botones para acciones -->*@
    <div class="row" style="margin-bottom:0">
        <div class="col s12 m5 l5">
            <div class="row" style="margin-bottom:0">
                <div class="input-field col s4">
                    @Html.EditorFor(model => model.D.USUARIOC_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIOC_ID, new { @id = "lbl_userid" })
                </div>
                <div class="input-field col s4">
                    @*<input type="text" id="txt_user" value="@ViewBag.usuario.MANAGER" disabled="disabled" />
                        <label for="txt_user">Manager</label>*@
                    @*@Html.EditorFor(model => model.D.USUARIO.MANAGER, new { htmlAttributes = new { @disabled = "disabled" } })
                        @Html.LabelFor(model => model.D.USUARIO.MANAGER, new { @id = "lbl_manager" })*@
                </div>
                <div class="input-field col s4">
                    @Html.EditorFor(model => model.D.USUARIO.BACKUP_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIO.BACKUP_ID, new { @id = "lbl_backup" })
                    @*<input type="text" id="txt_user" value="@ViewBag.usuario.BACKUP_ID" disabled="disabled" />
                        <label for="txt_user">Backup</label>*@
                </div>
            </div>
        </div>
        <div class="col s6 m2 l2">
            <div class="input-field col s6">
                @*<input type="text" id="txt_user" value="PRGA" disabled="disabled" />
                    <label for="txt_user">BU</label>*@
                @*@Html.EditorFor(model => model.D.USUARIO.BUNIT, new { htmlAttributes = new { @disabled = "disabled" } })
                    @Html.LabelFor(model => model.D.USUARIO.BUNIT, "Sociedad", new { @id = "lbl_bu" })*@
            </div>
            <div class="input-field col s6">
                @if (Model.D.ESTATUS == "N")
                {
                    <input type="text" id="txt_status" value="Nuevo" disabled="disabled" />
                    <label for="txt_status" id="lbl_status">Estatus</label>
                }
            </div>
        </div>
        <div class="col s12 m5 l5">
            <div class="row right">
                @if (Model.D.ESTATUS_C != "C")
                {
                    if (ViewBag.acciones != null)
                    {
                        if (ViewBag.accion == "A" | ViewBag.accion == "R")
                        {
                            @*<button type="button" class="btn-small  " id="btn_workf">Acciones</button>*@
                            <div class="fixed-action-btn" id="lbl_wf">
                                <a class="btn-floating btn-large blue">
                                    <i class="large material-icons">work</i>
                                </a>
                                <ul>
                                    <li><a id="lbl_wfa" class="btn-floating green modal-trigger" href="#modal1" onclick="aprobar()"><i class="material-icons">check</i></a></li>
                                    <li><a id="lbl_wfr" class="btn-floating red modal-trigger" href="#modal1" onclick="rechazar()"><i class="material-icons">close</i></a></li>
                                </ul>
                            </div>
                            <script>

                                var elem = document.querySelector('.fixed-action-btn');
                                var options = {
                                    direction: 'left',
                                    hoverEnabled: false,
                                    toolbarEnabled: false
                                };
                                var instance = M.FloatingActionButton.init(elem, options);
                            </script>
                            @*<a id="lbl_wfa" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="A" })">Aprobar</a>
                                <a id="lbl_wfr" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="R" })">Rechazar</a>*@
                            <a class="btn-small modal-trigger" href="#modal1" onclick="aprobar()">Aprobar</a>
                            <a class="btn-small modal-trigger" href="#modal1" onclick="rechazar()">Rechazar</a>
                        }
                        else if (ViewBag.accion == "N")
                        {
                            <div class="fixed-action-btn" id="lbl_wf">
                                <a class="btn-floating btn-large blue">
                                    <i class="large material-icons">work</i>
                                </a>
                                <ul>
                                    <li><a id="lbl_wfn" class="btn-floating yellow darken-1 modal-trigger" href="#modal1" onclick="siguiente()"><i class="material-icons">play_arrow</i></a></li>
                                </ul>
                            </div>
                            <script>

                                var elem = document.querySelector('.fixed-action-btn');
                                var options = {
                                    direction: 'left',
                                    hoverEnabled: false,
                                    toolbarEnabled: false
                                };
                                var instance = M.FloatingActionButton.init(elem, options);
                            </script>
                            @*<a id="lbl_wfn" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="N" })">Siguiente</a>*@
                            <a id="lbl_wfn" class="btn-small modal-trigger" href="#modal1" onclick="siguiente()">Siguiente</a>
                        }
                        else if (ViewBag.accion == "P")
                        {

                            <div class="fixed-action-btn" id="lbl_wf">
                                <a class="btn-floating btn-large blue">
                                    <i class="large material-icons">work</i>
                                </a>
                                <ul>
                                    <li><a id="lbl_wfn" class="btn-floating yellow darken-1 modal-trigger" href="#modal1" onclick="contabilizar()"><i class="material-icons">send</i></a></li>
                                    <li><a id="lbl_wfr" class="btn-floating red modal-trigger" href="#modal1" onclick="rechazar()"><i class="material-icons">close</i></a></li>
                                </ul>
                            </div>
                            <script>

                                var elem = document.querySelector('.fixed-action-btn');
                                var options = {
                                    direction: 'left',
                                    hoverEnabled: false,
                                    toolbarEnabled: false
                                };
                                var instance = M.FloatingActionButton.init(elem, options);
                            </script>
                            @*<a id="lbl_wfn" class="btn-small  " href="@Url.Action(" Procesa", "Flujos" , new { id=Model.D.NUM_DOC, accion="N" })">Siguiente</a>*@
                            <a id="lbl_wfn" class="btn-small modal-trigger" href="#modal1" onclick="contabilizar()">Contabilizar</a>
                            <a class="btn-small modal-trigger" href="#modal1" onclick="rechazar()">Rechazar</a>
                        }
                        else if (!Model.D.ESTATUS.Equals("A"))
                        {
                            if (Model.D.USUARIOC_ID == ViewBag.usuario.ID)
                            {
                                <a class="btn-small modal-trigger" id="btn_cancel" href="#modal2">Cancelar</a>
                                <div id="modal2" class="modal">
                                    <div class="modal-content">
                                        <div class="row">
                                            <h4 id="txt_can">Cancelar solicitud</h4>
                                            <br />
                                        </div>
                                        <div class="row" style="">
                                            <div class="col s12 m12 l12">
                                                <div class="row" style="margin-bottom:0">
                                                    ¿Está seguro de cancelar esta solicitud?
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer right">
                                        <a href="#!" class="modal-action modal-close btn-flat">No</a>
                                        <a class="modal-action btn-flat" href="@Url.Action("Cancelar", "Solicitudes" , new { id=Model.D.NUM_DOC })">Si</a>
                                    </div>
                                </div>
                            }
                        }
                    }
                    else if (!Model.D.ESTATUS.Equals("A"))
                    {
                        if (Model.D.USUARIOC_ID == ViewBag.usuario.ID)
                        {
                            <a class="btn-small modal-trigger" id="btn_cancel" href="#modal2">Cancelar</a>
                            <div id="modal2" class="modal">
                                <div class="modal-content">
                                    <div class="row">
                                        <h4 id="txt_can">Cancelar solicitud</h4>
                                        <br />
                                    </div>
                                    <div class="row" style="">
                                        <div class="col s12 m12 l12">
                                            <div class="row" style="margin-bottom:0">
                                                ¿Está seguro de cancelar esta solicitud?
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer right">
                                    <a href="#!" class="modal-action modal-close btn-flat">No</a>
                                    <a class="modal-action btn-flat" href="@Url.Action("Cancelar", "Solicitudes" , new { id=Model.D.NUM_DOC })">Si</a>
                                </div>
                            </div>
                        }
                    }

                    if (false)
                    {
                        <button type="button" class="btn-small  " data-target="list_carta" id="btn_carta">Carta</button>
                        @*<button type="button" class="btn-small  " id="btn_cancel">Cancelar</button>*@
                        <ul id='list_carta' class='dropdown-content'>
                            @*<li><a href="@Url.Action(" Index", "CartaF" , new { id=Model.D.NUM_DOC })" id="lbl_list">Lista de cartas</a></li>*@ @*//B20180720P MGC Guardar Carta*@
                            <li><a href="@Url.Action("Lista", "CartaV", new { id = Model.D.NUM_DOC, swf = Model.D.ESTATUS_WF })" id="lbl_list">Lista de cartas</a></li> @*//B20180720P MGC Guardar Carta*@
                            @if (Model.D.ESTATUS_WF.Equals("S"))
                            {
                                <li><a href="@Url.Action("Create", "CartaV", new { id = Model.D.NUM_DOC })" id="lbl_genc">Generar carta</a></li>
                            }
                            else
                            {
                                <li><a href="@Url.Action("Create", "CartaD", new { id = Model.D.NUM_DOC })" id="lbl_genc">Imprimir draft</a></li>
                            }
                        </ul>
                        <script>
                            var elem = document.getElementById('btn_carta');
                            var options = {
                                constrainWidth: false
                                //,hover: true
                            };
                            var instance = M.Dropdown.init(elem, options);
                        </script>
                    }
                    @* } *@
                }



            </div>
        </div>
    </div>

    @*MGC 04-10-2018 Botones para acciones <--*@

    <div class="div_bottom">
        <hr class="hr_bw" />
        <hr class="hr_color #4e342e brown darken-3" />
    </div>
</div>

<div class="row">
    <div class="col s12">
        <ul class="tabs" id="tabs">
            <li class="tab col s2 tabs_menu"><a id="tab_enc" href="#Encabezado_cont" class="">Encabezado NT</a></li>
            <li class="tab col s3 tabs_menu"><a id="tab_con" href="#Contable_cont">Info Contable NT</a></li>
            <li class="tab col s3 tabs_menu"><a id="tab_sop" href="#Soporte_cont">Soporte NT</a></li>
            <li class="tab col s3 tabs_menu"><a id="tab_sop" href="#Informacion_sap">Información SAP</a></li>
        </ul>
    </div>
</div>

@*@using (Html.BeginForm("Create", "Solicitudes", FormMethod.Post, new { enctype = "multipart/form-data", id = "formCreate" }))
    {
        @Html.AntiForgeryToken()*@
<div class="form-horizontal">
    @*Encabezado*@
    <div id="Encabezado_cont" class="col s12" style="font-size:12px;">
        <div class="row">
            <div class="col s12">
                <div class="card-panel">
                    <h5 id="head_cabecera">Cabecera NT</h5>
                    <div class="row" style="margin-bottom:0">
                        <div class="form-group col s6">
                            @Html.LabelFor(model => model.D.TSOL_ID, "Clase de documento NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.DropDownList("TSOL_ID", null, htmlAttributes: new { @disabled = "disabled", @class = "form-control" })

                            </div>
                        </div>
                        <div class="form-group col s6">
                            @Html.LabelFor(model => model.D.SOCIEDAD_ID, "Sociedad NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.DropDownList("SOCIEDAD_ID", null, htmlAttributes: new { @disabled = "disabled", @class = "form-control" })

                            </div>
                        </div>
                    </div>
                    <div class="row" style="margin-bottom:0">
                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.FECHAD, "Fecha documento NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.D.FECHAD, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>

                        <script>
                            fechacon = $('#FECHAD').val();

                            if (fechacon != null && fechacon != "") {
                                fechacon = fechacon.split(" ");
                                $('#FECHAD').val(fechacon[0]);
                            }

                        </script>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.FECHACON, "Fecha Contabilización NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.D.FECHACON, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>
                        <script>
                            fechacon = $('#FECHACON').val();

                            if (fechacon != null && fechacon != "") {
                                fechacon = fechacon.split(" ");
                                $('#FECHACON').val(fechacon[0]);
                            }

                        </script>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.FECHA_BASE, "Fecha Base Line NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.D.FECHA_BASE, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>

                        <script>
                            fechacon = $('#FECHA_BASE').val();

                            if (fechacon != null && fechacon != "") {
                                fechacon = fechacon.split(" ");
                                $('#FECHA_BASE').val(fechacon[0]);
                            }

                        </script>
                        <div id="div_norden_compra" class="input-field col s3" style="display:none">
                            <input type="text" id="norden_compra" value="" />@*Lejgg-09-10-2018*@
                            <label for="norden_compra" id="lbl_norden_compra">Orden de compra NT</label>
                        </div>
                    </div>
                    <div class="row" style="margin-bottom:0">
                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.MONEDA_ID, "Moneda NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.DropDownList("MONEDA_ID", null, htmlAttributes: new { @disabled = "disabled", @class = "form-control" })

                            </div>
                        </div>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.TIPO_CAMBIO, "Cambio NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @{ decimal tc = decimal.Parse(Model.D.TIPO_CAMBIO.ToString()); var _tc = formatoc.toShow(tc, ViewBag.dec);} @*LEJGG 16102018*@
                                @*@Html.EditorFor(model => model.D.TIPO_CAMBIO, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })*@
                                <input type="text" disabled class="form-control" id="TIPO_CAMBIO" name="TIPO_CAMBIO" value="@_tc" />@*LEJGG 16102018*@
                            </div>
                        </div>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.IMPUESTO, "Impuesto NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.DropDownList("IMPUESTO", null, htmlAttributes: new { @disabled = "disabled", @class = "form-control" })

                            </div>
                        </div>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.MONTO_DOC_MD, "Monto NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @*@Html.EditorFor(model => model.D.MONTO_DOC_MD, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })*@
                                <input type="text" disabled class="form-control" value="@montomd" />
                            </div>
                        </div>

                    </div>
                    <div class="row" style="margin-bottom:0">
                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.REFERENCIA, "Referencia NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10col s2">
                                @Html.EditorFor(model => model.D.REFERENCIA, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.CONCEPTO, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.D.CONCEPTO, "Concepto NT", new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.CONDICIONES, "Condiciones NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.D.CONDICIONES, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>

                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.CLAVE_CTA, "Clave Cuenta NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.D.CLAVE_CTA, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>
                    </div>
                    <div class="row" style="margin-bottom:0">
                        <div class="form-group col s3">
                            @Html.LabelFor(model => model.D.PAYER_ID, "Proveedor NT", htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.D.PAYER_ID, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                            </div>
                        </div>
                        @{string rfc = ""; string name = ""; }
                        @if (dprov != null)
                        {
                            rfc = dprov.STCD1.ToString();
                            name = dprov.NAME1.ToString();
                        }
                        <div class="form-group col s3">

                            <label class="control-label col-md-2" for="rfc_proveedor">RFC Proveedor NT</label>
                            <div class="col-md-10">
                                <input type="text" id="rfc_proveedor" disabled value="@rfc" />

                            </div>
                        </div>
                        <div class="form-group col s6">

                            <label class="control-label col-md-2" for="nom_proveedor">Nombre Proveedor NT</label>
                            <div class="col-md-10">
                                <input type="text" id="nom_proveedor" disabled value="@name" />

                            </div>
                        </div>
                    </div>
                </div>

                @*MGC 04-10-2018 Botones para acciones -->*@
                @*<div class="col s6">
                        <div class="card-panel">
                            <h5 id="head_flinea">Primera Línea del Documento NT</h5>
                            <div class="row" style="margin-bottom:0">
                                <div class="form-group col s5">
                                    @Html.LabelFor(model => model.D.TEXTO_POS, "Texto Posición NT", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-10">
                                        @Html.EditorFor(model => model.D.TEXTO_POS, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                                    </div>
                                </div>
                                <div class="form-group col s4">
                                    @Html.LabelFor(model => model.D.ASIGNACION_POS, "Asignación Posición NT", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col-md-10">
                                        @Html.EditorFor(model => model.D.ASIGNACION_POS, new { htmlAttributes = new { @disabled = "disabled", @class = "form-control" } })

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@
                @*MGC 04-10-2018 Botones para acciones <--*@

                @*<div class="col s6">*@ @*MGC 04-10-2018 Botones para acciones*@
                <div class="col s12" style="padding:0px">
                    @*MGC 04-10-2018 Botones para acciones*@
                    <div class="card-panel">
                        <h5 id="head_flinea">Retenciones NT</h5>
                        <div class="row" style="margin-bottom:0">
                            <table class="table display mdl-data-table striped" id="table_ret" style="width:100%;">
                                <thead>
                                    <tr>
                                        <th class="lbl_tret">
                                            Tipo Retención NT
                                        </th>
                                        <th class="lbl_descret">
                                            Descripción Retención NT
                                        </th>
                                        <th class="lbl_indret">
                                            Indicador de retención NT
                                        </th>
                                        <th class="lbl_bimponible">
                                            Base Imponible NT
                                        </th>
                                        <th id="lbl_impret">
                                            Importe de retención NT
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @*Obtener los decimales*@
                                    @{ string deci = ViewBag.dec; if (deci == null | deci == "") { deci = ""; } }
                                    @if (drets != null)
                                    {
                                        for (var i = 0; i < drets.Count; i++)
                                        {
                                            <tr>
                                                <td>

                                                    @Html.DisplayFor(m => drets[i].WITHT)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(m => drets[i].DESC)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(m => drets[i].WT_WITHCD)
                                                </td>
                                                <td>
                                                    @{ decimal bi = 0; try { bi = Convert.ToDecimal(drets[i].BIMPONIBLE); } catch (Exception) { }; string bim = formatoc.toShow(bi, deci);}
                                                    @bim
                                                </td>
                                                <td>
                                                    @{ decimal im = 0; try { im = Convert.ToDecimal(drets[i].IMPORTE_RET); } catch (Exception) { }; string ims = formatoc.toShow(im, deci);}
                                                    @ims
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

    @*Información Contable*@
    <div id="Contable_cont" class="col s12" style="font-size:12px;">
        <div class="row">
            <div class="col s12">
                <div class="card-panel">
                    <h5 id="head_cabecera">Detalle NT</h5>
                    <div class="row" style="margin-bottom:0">
                        <table class="table display mdl-data-table striped estiloT" id="table_info" style="width:100%;">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="lbl_pos">
                                        Pos NT
                                    </th>
                                    <th class="">
                                        N1
                                    </th>
                                    <th class="">
                                        N2
                                    </th>
                                    <th class="">
                                        N3
                                    </th>
                                    <th class="">
                                        N4
                                    </th>
                                    <th class="">
                                        N5
                                    </th>
                                    <th class="lbl_cargoAbono">
                                        D/H NT
                                    </th>
                                    <th class="lbl_factura">
                                        Factura NT
                                    </th>
                                    <th id="lbl_grupo">
                                        Grupo NT
                                    </th>
                                    <th id="lbl_cuenta">
                                        Cuenta NT
                                    </th>
                                    <th id="lbl_cuentaNom">
                                        Nombre de cuenta NT
                                    </th>
                                    <th id="lbl_tipoimp">
                                        Tipo Imp. NT
                                    </th>
                                    <th id="lbl_imputacion">
                                        Imputación NT
                                    </th>
                                    <th id="lbl_monto">
                                        Monto NT
                                    </th>
                                    <th id="lbl_iva">
                                        IVA NT
                                    </th>
                                    <th id="lbl_Texto">
                                        Texto
                                    </th>
                                    @for (int i = 0; i < colsret.Count; i++)
                                    {
                                        <th id="">
                                            @colsret[i] B.I.
                                        </th>
                                        <th id="">
                                            @colsret[i] I.R.
                                        </th>
                                    }
                                    <th id="lbl_Total">
                                        Total NT
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (@Model.D.DOCUMENTOPSTR != null)
                                {

                                    for (int i = 0; i < @Model.D.DOCUMENTOPSTR.Count; i++)
                                    {
                                        <tr>
                                            <td></td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].POS
                                            </td>
                                            @if (@Model.D.Anexo != null)
                                            {
                                                <td>@Model.D.Anexo[i].a1</td>
                                                <td>@Model.D.Anexo[i].a2</td>
                                                <td>@Model.D.Anexo[i].a3</td>
                                                <td>@Model.D.Anexo[i].a4</td>
                                                <td>@Model.D.Anexo[i].a5</td>
                                            }
                                            else
                                            {
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            }
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].ACCION
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].FACTURA
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].GRUPO
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].CUENTA
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].NOMCUENTA
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].TIPOIMP
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].IMPUTACION
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].MONTO
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].IVA
                                            </td>
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].TEXTO
                                            </td>
                                            @for (int y = 0; y < colsret.Count; y++)
                                            {
                                                <td>
                                                    @{var _v = colsret[y]; }
                                                    @{decimal imp = 0; try { imp = decimal.Parse(lstDrp.Where(p => p.POS == (i + 1) && p.WITHT == _v).FirstOrDefault().BIMPONIBLE.ToString()); } catch (Exception e) { }; string bim = formatoc.toShow(imp, deci);}
                                                    @bim
                                                </td>
                                                <td>
                                                    @{decimal imp2 = 0; try { imp2 = decimal.Parse(lstDrp.Where(p => p.POS == (i + 1) && p.WITHT == _v).FirstOrDefault().IMPORTE_RET.ToString()); } catch (Exception e) { }; string bim2 = formatoc.toShow(imp2, deci);}
                                                    @bim2
                                                </td>
                                            }
                                            <td>
                                                @Model.D.DOCUMENTOPSTR[i].TOTAL
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                            @*<tfoot id="tfoot_info" style="">
                                    <tr>
                                        <th colspan="10" style="text-align:right">Total:</th>
                                        <th id="total_info"></th>
                                    </tr>
                                </tfoot>*@
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col s12">
                <div class="card-panel">
                    <h5 id="head_cabecera">Anexos</h5>
                    <div class="row" style="margin-bottom:0">
                        <table class="table display mdl-data-table striped" id="table_anexa" style="width:100%;">
                            <thead>
                                <tr>
                                    <th class="">
                                        Num
                                    </th>
                                    <th class="">
                                        Status
                                    </th>
                                    <th class="">
                                        Tipo de Archivo
                                    </th>
                                    <th class="">
                                        Descripcion
                                    </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @using (Html.BeginForm("Descargar", "Solicitudes", FormMethod.Post))
                                {
                                    if (@Model.D.DOCUMENTOAL != null)
                                    {
                                        for (int i = 0; i < @Model.D.DOCUMENTOAL.Count; i++)
                                        {
                                            <tr>
                                                <td>
                                                    @(i + 1)
                                                </td>
                                                <td>OK</td>
                                                <td> @Model.D.DOCUMENTOAL[i].TIPO</td>
                                                <td> @Model.D.DOCUMENTOAL[i].DESC</td>
                                                @*<td> @Model.D.DOCUMENTOAL[i].PATH</td>*@
                                                <td>
                                                    @*<a data-form-method="post" href="#">
                                                            <i class='material-icons grey-text'>arrow_downward</i>
                                                        </a>*@
                                                    <button name="archivo" class="btn" type="submit" value="@Model.D.DOCUMENTOAL[i].PATH">DESCARGAR</button>
                                                </td>
                                            </tr>
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @*Soporte Contable*@
    <div id="Soporte_cont" class="col s12" style="font-size:12px;">
        <div class="row">
            <div class="col s12">
                <div class="card-panel">
                    <h5 id="head_cabecera">Detalle NT</h5>
                    <div class="row" style="margin-bottom:0">

                        @*<div class="file-field input-field" id="cargar_archivo">
                                <div class="btn">
                                    <span id="span_fileload">Examinar</span>
                                    <input id="file_sop" type="file">
                                </div>
                                <div class="file-path-wrapper">
                                    <input class="file-path validate" type="text">
                                </div>
                            </div>

                            <div id="div_btns_row_sop">
                                <a class="btn"><i class="material-icons left">add</i><span id="addRowSop">Registros Add NT</span></a>
                                <a class="btn"><i class="material-icons left">clear</i><span id="delRowSop">Registro Del NT</span></a>
                            </div>*@

                        <table class="table display mdl-data-table striped" id="table_sop" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>

                                    </th>
                                    <th class="lbl_opc">
                                        OPC NT
                                    </th>
                                    <th class="lbl_pos">
                                        Pos NT
                                    </th>
                                    <th class="lbl_rfc">
                                        RFC NT
                                    </th>
                                    <th class="lbl_factura">
                                        Factura NT
                                    </th>
                                    <th id="lbl_fecha">
                                        Fecha NT
                                    </th>
                                    <th id="lbl_monto">
                                        Monto NT
                                    </th>
                                    <th id="lbl_iva">
                                        IVA NT
                                    </th>
                                    <th id="lbl_total">
                                        Total NT
                                    </th>
                                    <th id="lbl_archivo">
                                        Archivo NT
                                    </th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                        <div class="form-group">
                            <div class="col-md-offset-2 col-md-10">
                                <input type="submit" value="Create" id="btn_guardar" style="display:none" class="btn btn-default" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @*Soporte SAP*@
    <div id="Informacion_sap" class="col s12" style="font-size:12px;">
        <div class="row">
            <div class="col s12">
                <div class="card-panel">
                </div>
            </div>
        </div>
    </div>

    @*MGC 04-10-2018 Botones para acciones WF-->*@
    @if (ViewBag.acciones != null)
    {
        using (Html.BeginForm("Procesa", "Flujos"))
        {
            <div id="modal1" class="modal  bottom-sheet">
                @Html.AntiForgeryToken()
                <div class="modal-content">
                    <div class="row">
                        <h4 id="txt_app" style="display:none">Aprobar solicitud</h4>
                        <h4 id="txt_rec" style="display:none"> Rechazar solicitud</h4>
                        <h4 id="txt_nex" style="display:none"> Agregar comentario</h4>
                        <h4 id="txt_cont" style="display:none">
                            Contabilizar
                        </h4>
                        <br />
                    </div>
                    <div class="row" style="">
                        <div class="col s12 m12 l12">
                            <div class="row" style="margin-bottom:0">
                                @Html.HiddenFor(model => model.F.WORKF_ID)
                                @*@Html.LabelFor(model => model.D.F.WORKF_ID, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.WF_VERSION)
                                @*@Html.LabelFor(model => model.D.F.WF_VERSION, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.WF_POS)
                                @*@Html.LabelFor(model => model.D.F.WF_POS, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.NUM_DOC)
                                @*@Html.LabelFor(model => model.D.F.NUM_DOC, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.LOOP)
                                @*@Html.LabelFor(model => model.D.F.LOOP, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.ESTATUS, new { @id = "wf_estatus" })
                                @*@Html.LabelFor(model => model.D.F.ESTATUS, new { @id = "lbl_userid" })*@
                                @Html.HiddenFor(model => model.F.RUTA_VERSION)
                                @Html.HiddenFor(model => model.F.ID_RUTA_A)
                                @Html.HiddenFor(model => model.F.STEP_AUTO)
                                <div class="input-field col s10 offset-s1">
                                    @Html.TextAreaFor(model => model.F.COMENTARIO, new { @class = "materialize-textarea", @id = "txt_comentario" })
                                    @Html.LabelFor(model => model.F.COMENTARIO, new { @id = "lbl_userid" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-fixed-footer right">
                    <a href="#!" class="modal-action modal-close btn-flat">Cancelar</a>
                    <input id="cont_send" type="submit" value="Aceptar" class="modal-action modal-close btn-flat" onclick="document.getElementById('loader').style.display = 'initial';" />
                    @*<a class="btn-small btn-default" href="@Url.Action(" Details", "Solicitudes" , new { id=Model.F.NUM_DOC})">Cancelar</a>*@
                </div>
            </div>
            if (ViewBag.accion == "R")
            {
                @*<div class="row" style="font-size:12px;">
                        <div class="col s12">
                            <div class="row" style="margin-bottom:0">
                                <div class="card-panel">
                                    <div class="row">
                                        <h5>Trade Spending</h5>
                                    </div>
                                    <div class="row">
                                        <div class="col l6 m6 s12">
                                            @foreach (var item in ViewBag.ts)
                                            {
                                                <div class="col s12">
                                                    <p style="margin-top:0;">
                                                        <label>
                                                            @foreach (var ii in item.TS_CAMPO.TS_FORMT)
                                                            {
                                                                if (ii.SPRAS_ID == Session["spras"].ToString())
                                                                {
                                                                    <input type="checkbox" id="chk-@item.TS_CAMPO.ID" name="chk-@item.TS_CAMPO.ID" />
                                                                    <span>@ii.TXT100</span>
                                                                }
                                                            }
                                                        </label>
                                                    </p>
                                                </div>
                                            }
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@
            }
            <script>

                var elem = document.getElementById('modal1');
                var instance = M.Modal.init(elem, []);
                var elem2 = document.getElementById('modal2');
                if (elem2 != undefined)
                    var instance2 = M.Modal.init(elem2, []);

                function aprobar() {
                    document.getElementById("txt_app").style.display = 'initial';
                    document.getElementById("txt_rec").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'none';
                    document.getElementById("txt_cont").style.display = 'none';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'A';
                }
                function rechazar() {
                    document.getElementById("txt_rec").style.display = 'initial';
                    document.getElementById("txt_app").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'none';
                    document.getElementById("txt_cont").style.display = 'none';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'R';
                }
                function siguiente() {
                    document.getElementById("txt_rec").style.display = 'none';
                    document.getElementById("txt_app").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'initial';
                    document.getElementById("txt_cont").style.display = 'none';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'A';
                }
                function contabilizar() {
                    document.getElementById("txt_rec").style.display = 'none';
                    document.getElementById("txt_app").style.display = 'none';
                    document.getElementById("txt_nex").style.display = 'none';
                    document.getElementById("txt_cont").style.display = 'initial';
                    document.getElementById("txt_comentario").value = '';
                    document.getElementById("wf_estatus").value = 'A';
                    document.getElementById('cont_send').click();

                }
            </script>
        }
    }
    @if (ViewBag.workflow.Count != 0)
    {
        <div class="row" style="font-size:12px;">
            <div class="col s12" style="padding:0px">
                <div class="card-panel">
                    <div class="row" style="margin-bottom:0">
                        <h5>Workflow</h5>
                        <table class="table highlight responsive-table" id="table">
                            <thead>
                                <tr>
                                    <th width="">
                                        Usuario
                                    </th>
                                    <th width="">
                                        Evento
                                    </th>
                                    <th width="">
                                        Fecha inicio
                                    </th>
                                    <th width="">
                                        Hora inicio
                                    </th>
                                    <th width="">
                                        Fecha término
                                    </th>
                                    <th width="">
                                        Hora término
                                    </th>
                                    <th width="">
                                        Estatus
                                    </th>
                                    <th width="30%">
                                        Comentario
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (WFARTHA.Entities.FLUJO f in ViewBag.workflow)
                                {
                                    <tr>
                                        <td width=""> @Html.DisplayFor(modelItem => f.USUARIOA_ID) - @Html.DisplayFor(modelItem => f.USUARIO.NOMBRE) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_P) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_M) </td>
                                        <td width=""> @Html.DisplayFor(modelItem => f.WORKFP.ACCION.DESCCRIPCION) </td>
                                        <td width=""> @f.FECHAC.Value.ToShortDateString() </td>
                                        <td width=""> @f.FECHAC.Value.TimeOfDay.ToString().Split('.')[0] </td>
                                        <td width=""> @f.FECHAM.Value.ToShortDateString() </td>
                                        <td width=""> @f.FECHAM.Value.TimeOfDay.ToString().Split('.')[0] </td>
                                        <td width=""> @Html.DisplayFor(modelItem => f.ESTATUS) </td>
                                        <td width="30%"> @Html.DisplayFor(modelItem => f.COMENTARIO) </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    }
    @*MGC 04-10-2018 Botones para acciones WF<--*@

    <input id="num_doc_send" type="text" value="@Model.D.NUM_DOC" style="display:none" />
</div>



@*}*@
